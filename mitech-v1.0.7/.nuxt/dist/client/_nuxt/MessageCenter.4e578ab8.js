import{_ as p}from"./Header.460fa155.js";import{_ as f}from"./Breadcrumbs.18353780.js";import{a as $,g as U}from"./state.4da28978.js";import{a as c}from"./axios.28bc18a3.js";import{aJ as M,$ as l,a0 as _,a1 as t,F as k,as as B,ak as m,aa as u,ai as F,n as r}from"./_plugin-vue_export-helper.2c3522c3.js";import{_ as b}from"./ChatBot.85e95aeb.js";import{_ as x}from"./Footer.c5032859.js";import"./entry.0cdb93ce.js";import"./HeaderTop.fc351d8a.js";const L={data(){const s={Authorization:"token "+$().value};return{checkUrl:"http://121.36.19.201/api/message/",deleteUrl:"http://121.36.19.201/api/message/remove",readUrl:"http://121.36.19.201/api/message/read",messages:[],headers:s,dataLoaded:!0}},methods:{async getData(){await c.get(this.checkUrl,{headers:this.headers}).then(s=>{console.log(s.data),this.messages=s.data,this.dataLoaded=!1}).catch(s=>{console.log(s)})},markAsRead(s,e){this.readMessage(e)},deleteMessages(){const s=this.userMessages;var e={};this.messages=[],s.forEach(o=>{(o.type==6||o.type==10)&&(e={message_id:o.id}),c.post(this.deleteUrl,e,{headers:this.headers}).then(a=>{console.log(a.data)}).catch(a=>{console.log(a)})})},deleteMessage(s){console.log(s);const e=this.messages.findIndex(a=>a.id===s);e!==-1&&this.messages.splice(e,1);const o={message_id:s};c.post(this.deleteUrl,o,{headers:this.headers}).then(a=>{console.log(a.data)}).catch(a=>{console.log(a)})},readMessages(){var s={};this.userMessages.forEach(e=>{e.is_read=!0,s={message_id:e.id},c.post(this.readUrl,s,{headers:this.headers}).then(o=>{console.log(o.data)}).catch(o=>{console.log(o)})})},readMessage(s){console.log(s);const e=this.messages.findIndex(a=>a.id===s);e!==-1&&(this.messages[e].is_read=!0);const o={message_id:s};c.post(this.readUrl,o,{headers:this.headers}).then(a=>{console.log(a.data)}).catch(a=>{console.log(a)})},put(){console.log(this.messages)}},computed:{userMessages:function(){return this.messages==[]||this.messages==null?[]:this.messages.filter(function(s){return s.type!=10&&s.type!=6})}},async mounted(){await this.getData()}},D={key:0,class:"message-table"},A={class:"message-tr-head"},E=t("th",{class:"message-th"},"消息ID",-1),I=t("th",{class:"message-th1"},"消息内容",-1),N={class:"message-button"},V=t("span",null,"全部删除",-1),w=[V],z={class:"message-button"},H=t("span",null,"全部已读",-1),R=[H],T=["onClick"],J={class:"message-td"},S={class:"message-td1"},j={class:"message-button"},q=["onClick"],G=t("span",null,"删 除",-1),K=[G],O={class:"message-button"},P=["onClick"],Q=t("span",null,"已 读",-1),W=[Q];function X(s,e,o,a,h,d){return l(),_("div",{class:u(["message",{hidden:h.dataLoaded}])},[h.messages?(l(),_("table",D,[t("tr",A,[E,I,t("th",N,[t("button",{class:"message-btn",onClick:e[0]||(e[0]=n=>d.deleteMessages())},w)]),t("th",z,[t("button",{class:"message-btn",onClick:e[1]||(e[1]=n=>d.readMessages())},R)])]),(l(!0),_(k,null,B(d.userMessages,(n,g)=>(l(),_("tr",{class:"message-tr",key:n.id,onClick:i=>d.markAsRead(g,n.id)},[t("td",J,m(n.id),1),t("td",S,m(n.content),1),t("td",j,[t("button",{class:"message-btn1",onClick:i=>d.deleteMessage(n.id)},K,8,q)]),t("td",O,[t("button",{class:"message-btn1",onClick:i=>d.readMessage(n.id)},W,8,P)]),t("div",{class:u(["unreadFlag",{hidden:n.is_read}])},null,2)],8,T))),128))])):F("",!0)],2)}const C=M(L,[["render",X]]),Y={components:{Message:C,Header:p,Footer:x,Breadcrumbs:f,ChatBot:b},data(){return{data:[]}},mounted(){U()}};function Z(s,e,o,a,h,d){const n=p,g=f,i=C,v=b,y=x;return l(),_(k,null,[r(n),r(g,{items:"Message Center",breadcrumbTitle:"Message Center"}),r(i),r(v),r(y)],64)}const ls=M(Y,[["render",Z]]);export{ls as default};
