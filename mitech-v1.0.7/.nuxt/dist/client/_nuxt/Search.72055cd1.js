import{_ as R}from"./Header.460fa155.js";import{_ as T}from"./ChatBot.85e95aeb.js";import{_ as W}from"./Footer.c5032859.js";import{c as Q,d as X,s as B,l as O,g as Y,m as Z}from"./state.4da28978.js";import{j as K,q as x,M as ee,N as te,O as ae,k as z,P as oe,s as q,Q as se,R as le,S as ne,T as re,h as L,U as j,V as H,W as ie,X as de,Y as ce,Z as ue,$ as pe,a0 as _e,a1 as me,i as he,a2 as fe,a3 as ve,F as ge,G as $e,I as ye,r as ke}from"./entry.0cdb93ce.js";/* empty css             *//* empty css                 *//* empty css                *//* empty css                        *//* empty css                  *//* empty css                  *//* empty css                   *//* empty css               *//* empty css               *//* empty css                */import{a as G}from"./axios.28bc18a3.js";/* empty css                */import{a0 as h,a1 as d,n as o,af as s,aJ as I,$ as u,aj as m,F as y,as as C,ae as $,P as b,ak as _,ai as V,ag as we,aM as be,aN as Ce,U as A}from"./_plugin-vue_export-helper.2c3522c3.js";import"./HeaderTop.fc351d8a.js";const w=a=>(be("data-v-a874f99d"),a=a(),Ce(),a),Se={class:"hello"},Ee={class:"filter"},Ve=w(()=>d("div",{class:"space"},null,-1)),De=w(()=>d("div",{class:"space2"},null,-1)),Fe={class:"select-num"},Le={class:"min-height"},Pe={key:0,class:"mid"},Me={class:"item"},Ne={class:"tag"},Ie={class:"subtag"},Ue=w(()=>d("div",{class:"tag-color"}," ",-1)),Be={class:"tag-content"},Oe={class:"subtag"},Ae=w(()=>d("div",{class:"tag-color"}," ",-1)),Re={class:"tag-content"},Te={class:"subtag"},We=w(()=>d("div",{class:"tag-color"}," ",-1)),Ye={class:"tag-content"},Ke=["onClick"],ze={class:"article-key-word"},qe=w(()=>d("span",{class:"prop"},"关键词 :  ",-1)),je=w(()=>d("span",{class:"prop"},"摘 要 :  ",-1)),He={class:"article-else"},N=["keyword"],P=10,Ge={data(){return{fold:!0,more:!1,cnt:0,perPage:P,loading:!1,fields:{},filterProps:N,checkedFilter:{author:[],field:[],keyword:[],periodical:[]},filter:{author:[],field:[],keyword:[],periodical:[]},selectedMap:new Map,url:["",""],keywords:{},recommends:[{keyword:"",count:0},{keyword:"",count:0},{keyword:"",count:0},{keyword:"",count:0},{keyword:"",count:0}],activeNames:[],currentPage:1,count:0,list:""}},mounted(){L.on("search-url",a=>{if(this.cnt==0){if(this.cnt=1,this.$data.currentPage=1,a==this.$data.url)return;this.$data.url=a,this.getResults(!0),this.cnt=0}})},methods:{changeState(){this.fold=!this.fold},handleChange(){},getResults(a){a&&this.$data.selectedMap.clear();var e=this.$data.url[0]+this.$data.currentPage+this.$data.url[1];console.log(e),this.$data.loading=!0;var t=setTimeout(()=>{this.$data.loading&&(this.$data.loading=!1,j.error("搜索超时..."))},1e4);scrollTo(0,0),G.post(e,{isAdvanced:"1"},{headers:{"Content-Type":"application/json"}}).then(l=>{console.log(l),clearTimeout(t),a&&this.init(),this.$data.count=l.data.meta.count,this.$data.list=l.data.results;for(var i=0;i<this.$data.list.length;i++){var p=this.$data.list[i];this.$data.selectedMap.has(p.id)&&(p.selected=!0);for(var v=[],f=[],c=0;c<p.keywords.length;c++)v.push(p.keywords[c].keyword),this.$data.keywords[p.keywords[c].keyword]||(this.$data.keywords[p.keywords[c].keyword]=1),this.updateRecommends(p.keywords[c].keyword,this.$data.keywords[p.keywords[c].keyword]);for(var c=0;c<p.authorships.length;c++)f.push(p.authorships[c].author.display_name);this.$data.list[i]._keywords=v,this.$data.list[i]._authors=f}a&&(this.$data.fields=l.data.concepts_count,this.$data.more=JSON.stringify(this.$data.fields).split(":").length>=3),this.$data.loading=!1}).catch(l=>{clearTimeout(t),this.$data.loading=!1})},gotoDetail(a){Q().value=a.id,X().value=a.display_name,B();let e=this.$router.resolve({path:"/articledetail"});window.open(e.href,"_blank")},analyse(){O().value=[];for(let e of this.$data.selectedMap.values())O().value.push(e);B();let a=this.$router.resolve({path:"/netForEssay"});window.open(a.href,"_blank")},selectAll(a){for(var e=0;e<this.$data.list.length;e++)this.select(this.$data.list[e],a);a||this.$data.selectedMap.clear()},selectWithField(a,e){for(var t=0;t<this.$data.list.length;t++)a==this.$data.list[t].concepts[0].display_name&&this.select(this.$data.list[t],e)},select(a,e){if(a.selected=e,e){var t={id:a.id,title:a.display_name,referenced_works:a.referenced_works,related_works:a.related_works};this.$data.selectedMap.set(a.id,t)}else this.$data.selectedMap.delete(a.id)},init(){this.$data.keywords={},this.$data.recommends=[{keyword:"",count:0},{keyword:"",count:0},{keyword:"",count:0},{keyword:"",count:0},{keyword:"",count:0}]},search(a){L.emit("search",a)},updateRecommends(a,e){var t=0;for(t=0;t<5;t++)if(a==this.$data.recommends[t].keyword&&this.$data.recommends[t].count>=e)return;for(t=0;t<5;t++)if(e>=this.$data.recommends[t].count){if(a==this.$data.recommends[t].keyword){this.$data.recommends[t].count=e;return}break}var l;for(l=t+1;l<5&&a!=this.$data.recommends[l].keyword;l++);var i=t;for(t=l-1;t>i;t--)this.$data.recommends[t]=this.$data.recommends[t-1];i!=5&&(this.$data.recommends[i]={keyword:a,count:e})},handleCurrentChange(a){this.$data.currentPage=a,this.getResults(!1)},visible(a){return parseInt(a/P)==this.$data.currentPage-1},display(a){for(let l of N){var e=a[l],t=!1;for(let i of this.$data.checkedFilter[l])if(e.has(i)){t=!0;break}if(!t)return!1}return!0},getAllFilterInfo(){for(let e of N){const t=new Set;for(let l of this.$data.list){var a=l[e];for(let i of a)t.has(i)||t.add(i)}this.$data.filter[e]=[],this.$data.checkedFilter[e]=[];for(let l of t)this.$data.filter[e].push(l),this.$data.checkedFilter[e].push(l)}}}},Je=Object.assign(Ge,{__name:"ResultList",setup(a){return(e,t)=>{const l=K,i=x,p=ee,v=te,f=ae,c=z,k=oe,g=q,S=se,M=le,D=ne,F=re;return u(),h("div",Se,[d("div",Ee,[o(v,{position:"top",offset:120},{default:s(()=>[o(l,{class:"filter-title"},{default:s(()=>[m("相关搜索")]),_:1}),(u(!0),h(y,null,C(e.recommends,n=>(u(),$(l,{class:"recommend-row",onClick:r=>e.search(n.keyword)},{default:s(()=>[n.keyword?(u(),$(p,{key:0,class:"recommend"},{default:s(()=>[o(i,null,{default:s(()=>[o(b(H))]),_:1}),m(" "+_(n.keyword),1)]),_:2},1024)):V("",!0)]),_:2},1032,["onClick"]))),256)),Ve,o(l,{class:"filter-title"},{default:s(()=>[m("领域筛选")]),_:1}),(u(!0),h(y,null,C(e.fields,(n,r,E)=>(u(),h(y,null,[E<(e.fold?3:8)?(u(),$(l,{key:0,class:"field"},{default:s(()=>[o(i,{class:"field-button",onClick:U=>e.selectWithField(r,!0)},{default:s(()=>[o(b(ie))]),_:2},1032,["onClick"]),o(i,{class:"field-button",onClick:U=>e.selectWithField(r,!1)},{default:s(()=>[o(b(de))]),_:2},1032,["onClick"]),o(p,null,{default:s(()=>[m(_(r)+"("+_(n)+")",1)]),_:2},1024)]),_:2},1024)):V("",!0)],64))),256)),e.more?(u(),$(l,{key:0,class:"more",onClick:t[0]||(t[0]=n=>e.changeState())},{default:s(()=>[o(p,null,{default:s(()=>[m(_(e.fold?"More...":"Fold"),1)]),_:1})]),_:1})):V("",!0),De]),_:1})]),o(D,null,{default:s(()=>[o(f,{width:"300px",class:"aside-back"}),o(D,{class:"result-display"},{default:s(()=>[o(M,null,{default:s(()=>[d("div",Fe,[m(" 已选择："+_(e.selectedMap.size)+"   ",1),o(c,{onClick:t[1]||(t[1]=n=>e.selectAll(!1))},{default:s(()=>[m("清空选择")]),_:1}),o(c,{onClick:t[2]||(t[2]=n=>e.selectAll(!0))},{default:s(()=>[m("全选当页")]),_:1}),o(c,{onClick:t[3]||(t[3]=n=>e.analyse())},{default:s(()=>[m("数据分析")]),_:1})]),we((u(),h("div",Le,[e.list.length?V("",!0):(u(),h("div",Pe,[o(k,{description:"当前暂时没有结果捏~"})])),(u(!0),h(y,null,C(e.list,n=>(u(),h("div",null,[d("div",Me,[o(c,{class:"select-button",type:n.selected?"primary":"default",icon:n.selected?b(ce):b(ue),onClick:r=>e.select(n,!n.selected)},null,8,["type","icon","onClick"]),(u(),$(g,{class:"article",key:n.id},{default:s(()=>[d("div",null,[d("div",Ne,[d("div",Ie,[Ue,d("div",Be," 发布时间 : "+_(n.publication_date)+" ",1)]),d("div",Oe,[Ae,d("div",Re," 引用量 : "+_(n.cited_by_count)+" ",1)]),d("div",Te,[We,d("div",Ye," 相关度 : "+_((n.relevance_score?n.relevance_score:n.concepts[0].score*1e3).toFixed(2))+" ",1)])]),d("p",{class:"article-title",onClick:r=>e.gotoDetail(n)},_(n.title),9,Ke),d("p",ze,[qe,m(_(n._keywords.length?n._keywords.join(", "):"(NULL)"),1)]),o(p,{"line-clamp":"4",class:"article-abstract"},{default:s(()=>[je,m(_(n.abstract?n.abstract:"(NULL)"),1)]),_:2},1024),d("p",He,[d("p",null,"作者 : "+_(n._authors.length?n._authors.join(", "):"(NULL)"),1),d("span",null,"领域 : "+_(n.concepts[0].display_name?n.concepts[0].display_name:"(NULL)"),1),m("  "),d("span",null,"期刊 : "+_(n.primary_location.source?n.primary_location.source.display_name:"(NULL)"),1)])])]),_:2},1024))])]))),256))])),[[F,e.loading]]),o(S,{class:"mid",onCurrentChange:e.handleCurrentChange,"current-page":e.currentPage,"page-size":P,layout:"total, prev, pager, next",total:e.count},null,8,["onCurrentChange","current-page","total"])]),_:1})]),_:1}),o(f,{width:"40px"})]),_:1})])}}}),Qe=I(Je,[["__scopeId","data-v-a874f99d"]]);const J=[{text:"最近一个月",value:()=>{const a=new Date;return[new Date(new Date-1e3*60*60*24*30),a]}},{text:"最近半年",value:()=>{const a=new Date;return[new Date(new Date-1e3*60*60*24*180),a]}},{text:"今年至今",value:()=>{const a=new Date,e=new Date().getFullYear();return[new Date(e,0,1),a]}}],Xe={data(){return{cnt:0,input:"",ascendNumber:0,label:{author:"作者",periodical:"期刊",timespan:"时间",field:"领域"},form:{author:"",periodical:"",timespan:"",field:""},selectedSortKey:"relevance_score",sortKey:[{value:"publication_year",label:"发布时间"},{value:"relevance_score",label:"相关度"},{value:"cited_by_count",label:"引用量"}],selectedSortOrder:"desc",sortOrder:[{value:"desc",label:"降序"},{value:"asc",label:"升序"}],shortcuts:J}},mounted(){L.on("search",a=>{if(this.cnt==0){if(this.cnt=1,this.$data.input==a)return;this.$data.input=a,this.onSubmit(),this.cnt=0}}),Y(),this.$data.input=Z().value,this.$data.input&&setTimeout(()=>{this.onSubmit()},200)},methods:{querySearchAsync(a,e){var t=++this.$data.ascendNumber;G.get("https://api.openalex.org/autocomplete/works?q="+a).then(l=>{if(this.ascendNumber==t){var i=l.data.results;e(i)}}).catch(l=>{console.log(l)})},handleClose(a){this.$data.form[a]=""},onSubmit(){if(!this.$data.input){j.error("Please enter something~");return}var a=this.$data.input,e="1970-01-01";this.$data.form.timespan[0]&&(e=this.$data.form.timespan[0]);var t="2023-12-25";this.$data.form.timespan[1]&&(t=this.$data.form.timespan[1]);var l=this.$data.form.author,i=this.$data.form.field,p=this.$data.form.periodical,v=this.$data.selectedSortKey+":"+this.$data.selectedSortOrder,f="http://121.36.19.201/api/get_works/?filter=from_publication_date:"+e+",to_publication_date:"+t+(l?",authorships.author.display_name:"+l:"")+(i?",concepts.display_name:"+i:"")+(p?",locations.source.display_name:"+p:"")+"&page=",c="&per_page="+P+"&search="+a+"&sort="+v,k=[f,c];L.emit("search-url",k)}}},Ze=Object.assign(Xe,{__name:"SearchBar",setup(a){return(e,t)=>{const l=ge,i=$e,p=pe,v=ye,f=z,c=_e,k=me,g=he,S=K,M=ke,D=q,F=fe,n=ve;return u(),h("div",null,[o(D,{class:"search-bar"},{default:s(()=>[o(S,{class:"row-40"},{default:s(()=>[o(g,{span:23},{default:s(()=>[o(k,{placeholder:"请输入内容",modelValue:e.input,"onUpdate:modelValue":t[5]||(t[5]=r=>e.input=r),"value-key":"display_name","popper-append-to-body":!1,"popper-class":"match-list","fetch-suggestions":e.querySearchAsync,class:"input-with-select"},{prepend:s(()=>[o(c,{placement:"bottom-start",width:"500",trigger:"click"},{reference:s(()=>[o(f,null,{default:s(()=>[m("高级搜索")]),_:1})]),default:s(()=>[d("div",null,[o(v,{model:e.form,"label-width":"175px",class:"search-detail-form",size:"large"},{default:s(()=>[o(i,{label:"显示以下作者所著的文章:"},{default:s(()=>[o(l,{modelValue:e.form.author,"onUpdate:modelValue":t[0]||(t[0]=r=>e.form.author=r)},null,8,["modelValue"])]),_:1}),o(i,{label:"显示以下刊物发表的文章:"},{default:s(()=>[o(l,{modelValue:e.form.periodical,"onUpdate:modelValue":t[1]||(t[1]=r=>e.form.periodical=r)},null,8,["modelValue"])]),_:1}),o(i,{label:"显示以下领域相关的文章:"},{default:s(()=>[o(l,{modelValue:e.form.field,"onUpdate:modelValue":t[2]||(t[2]=r=>e.form.field=r)},null,8,["modelValue"])]),_:1}),o(i,{label:"显示以下时间发表的文章:"},{default:s(()=>[o(p,{modelValue:e.form.timespan,"onUpdate:modelValue":t[3]||(t[3]=r=>e.form.timespan=r),"value-format":"YYYY-MM-DD",type:"daterange",align:"right","unlink-panels":"","range-separator":"——","start-placeholder":"Start Date","end-placeholder":"End Date",shortcuts:J},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])]),_:1})]),append:s(()=>[o(f,{type:"success",icon:b(H),onClick:t[4]||(t[4]=r=>e.onSubmit()),id:"search-button"},null,8,["icon"])]),_:1},8,["modelValue","fetch-suggestions"])]),_:1})]),_:1}),o(S,{class:"search-tag-row"},{default:s(()=>[(u(!0),h(y,null,C(e.form,(r,E)=>(u(),h(y,null,[r?(u(),$(M,{class:"search-tag",key:E,"disable-transitions":!1,closable:"",onClose:U=>e.handleClose(E)},{default:s(()=>[m(_(e.label[E])+" : "+_(r),1)]),_:2},1032,["onClose"])):V("",!0)],64))),256))]),_:1})]),_:1}),o(S,{class:"filter-row"},{default:s(()=>[o(g,{offset:12,span:4,class:"filter-title"}),o(g,{span:4},{default:s(()=>[o(n,{modelValue:e.selectedSortKey,"onUpdate:modelValue":t[6]||(t[6]=r=>e.selectedSortKey=r),onChange:t[7]||(t[7]=r=>e.onSubmit()),size:"large"},{default:s(()=>[(u(!0),h(y,null,C(e.sortKey,r=>(u(),$(F,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(g,{span:4},{default:s(()=>[o(n,{modelValue:e.selectedSortOrder,"onUpdate:modelValue":t[8]||(t[8]=r=>e.selectedSortOrder=r),onChange:t[9]||(t[9]=r=>e.onSubmit()),size:"large"},{default:s(()=>[(u(!0),h(y,null,C(e.sortOrder,r=>(u(),$(F,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})])}}}),xe=I(Ze,[["__scopeId","data-v-c8dc2525"]]),et={data(){return{}},methods:{},components:{SearchBar:xe,ResultList:Qe,Footer:W,Header:R,ChatBot:T},mounted(){Y()}},tt={class:"main-container"};function at(a,e,t,l,i,p){const v=R,f=A("SearchBar"),c=A("ResultList"),k=T,g=W;return u(),h("div",tt,[o(v),o(f),o(c),o(k),o(g)])}const wt=I(et,[["render",at]]);export{wt as default};
